<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MsgFlo | Discovery protocol</title>
    <link rel="stylesheet" href="/stylesheets/flo.css">
    <link rel="stylesheet" href="/stylesheets/zenburn.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#70A7C6">
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-46363984-7', 'auto');
      ga('send', 'pageview');
    </script>


  </head>
  <body class="page">
    <nav class="main">
  <ul onclick="void(0)">
    <li class="home">
      <a href="/">
        
        <img class="logo" src="/assets/msgflo-logo.png" alt="MsgFlo">
        
      </a>
    </li>
    <ul>
    
      
      
      <li>
        <a href="/docs/usage/index.html" class="current">
          
          Documentation
          
        </a>
      </li>
        
      
      
      
      <li>
        <a href="/examples/c-base/index.html">
          
          Examples
          
        </a>
      </li>
        
      
      
      
      
      
      
      <li><a href="https://github.com/msgflo">GitHub</a></li>
      
    </ul>
  </ul>
</nav>

    
<main>
  <article>
    
    <h1>Discovery protocol</h1>
    
    <p>All communications between the coordinator and the participants happens using the message queue.
The network coordinator and the participants have channels to communicate,
and when different processes provided by participants are connected with each other,
these also pass through a queue.</p>

<h3 id="message-format">Message format</h3>

<p>Each message sent between Participants and Coordinator has the following format:</p>

<ul>
  <li><code class="highlighter-rouge">protocol</code>: Which sub-protocol is used</li>
  <li><code class="highlighter-rouge">command</code>: The command this message is on the given sub-protocol</li>
  <li><code class="highlighter-rouge">payload</code>: The message payload</li>
</ul>

<h3 id="participant-discovery">Participant discovery</h3>

<p>The network coordinator subscribes to a queue named <code class="highlighter-rouge">fbp</code>.</p>

<p>Once a participant becomes available, it announces its availability by sending a message to this queue
with <code class="highlighter-rouge">protocol</code>: ‘discovery’ and <code class="highlighter-rouge">command</code>: ‘participant’.</p>

<p>In case of systems incapable of communicating via FBP protocol
but which can nonetheless be connected to a network,
the message <code class="highlighter-rouge">payload</code> contains the following information:</p>

<ul>
  <li><code class="highlighter-rouge">id</code>: short unique name for the participant. Ex: measure1</li>
  <li><code class="highlighter-rouge">role</code>: the role this participant has in the network. Used to group multiple partipants. Ex: measure</li>
  <li><code class="highlighter-rouge">component</code>: the component name of the participant. One component may be used in several roles. For instance MeasurementWorker</li>
  <li><code class="highlighter-rouge">label</code>: (optional) human-readable description of the system</li>
  <li><code class="highlighter-rouge">icon</code>: (optional) icon to use to describe the system, using <a href="http://fontawesome.io/icons/">Font Awesome</a> semantics</li>
  <li><code class="highlighter-rouge">inports</code>: list of inports containing:
    <ul>
      <li><code class="highlighter-rouge">id</code>: port name</li>
      <li><code class="highlighter-rouge">queue</code>: the message queue the process listens to</li>
      <li><code class="highlighter-rouge">type</code>: port datatype, for example <code class="highlighter-rouge">boolean</code></li>
      <li><code class="highlighter-rouge">options</code>: queue options as specified by the message queue implementation</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">outports</code>: list of outports containing:
    <ul>
      <li><code class="highlighter-rouge">id</code>: port name</li>
      <li><code class="highlighter-rouge">queue</code>: the message queue the process transmits to</li>
      <li><code class="highlighter-rouge">type</code>: port datatype, for example <code class="highlighter-rouge">boolean</code></li>
      <li><code class="highlighter-rouge">options</code>: queue options as specified by the message queue implementation</li>
    </ul>
  </li>
</ul>

<p>If the participant is itself implemented using FBP and supports the
<a href="https://flowbased.github.io/fbp-protocol/">FBP runtime protocol</a>, these additional keys should be defined.</p>

<ul>
  <li><code class="highlighter-rouge">type</code>: type of the runtime, for example <code class="highlighter-rouge">noflo-nodejs</code> or <code class="highlighter-rouge">microflo</code></li>
  <li><code class="highlighter-rouge">version</code>: version of the runtime protocol that the runtime supports, for example <code class="highlighter-rouge">0.4</code></li>
  <li><code class="highlighter-rouge">inqueue</code>:  name of the message queue the participant listens for FBP protocol messages</li>
  <li><code class="highlighter-rouge">outqueue</code>:  name of the message queue the participant sends FBP protocol messages</li>
</ul>

<h4 id="participant-changes">Participant changes</h4>

<p>When changes are made in the participant,
the <code class="highlighter-rouge">participant</code> message should be resent with the updated data.</p>

<h4 id="heartbeat">Heartbeat</h4>

<p>The <code class="highlighter-rouge">participant</code> message should be re-sent periodically.
If no message is received within seconds,
the participant will be assumed to have stopped.
The default limit is 600 seconds.</p>

<p>Note: if sending data on ports on a sporadic connection,
one should first send a <code class="highlighter-rouge">participant</code> message for the data.</p>


  </article>
  <nav class="docs">
  
  
  <ul>
  
  
    <li>
      <a href="/docs/usage/index.html">
        Usage
      </a>
    </li>
  
    <li>
      <a href="/docs/communications/index.html" class="current">
        Discovery protocol
      </a>
    </li>
  
    <li>
      <a href="/docs/library/index.html">
        Component library
      </a>
    </li>
  
    <li>
      <a href="/docs/architecture/index.html">
        Architecture
      </a>
    </li>
  
    <li>
      <a href="/docs/heroku/index.html">
        Heroku deployment
      </a>
    </li>
  
    <li>
      <a href="/docs/foreign/index.html">
        Non-MsgFlo-aware participants
      </a>
    </li>
  
    <li>
      <a href="/docs/best-practices/index.html">
        Best practices
      </a>
    </li>
  
  </ul>
  

  

  

  

</nav>

</main>

  </body>
</html>
