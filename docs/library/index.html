<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MsgFlo | Component library</title>
    <link rel="stylesheet" href="/stylesheets/flo.css">
    <link rel="stylesheet" href="/stylesheets/zenburn.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="MsgFlo Updates">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#70A7C6">
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-46363984-7', 'auto');
      ga('send', 'pageview');
    </script>


  </head>
  <body class="page">
    <nav class="main">
  <ul onclick="void(0)">
    <li class="home">
      <a href="/">
        
        <img class="logo" src="/assets/msgflo-logo.png" alt="MsgFlo">
        
      </a>
    </li>
    <ul>
    
      
      
      <li>
        <a href="/docs/usage/index.html" class="current">
          
          Documentation
          
        </a>
      </li>
        
      
      
      
      <li>
        <a href="/examples/c-base/index.html">
          
          Examples
          
        </a>
      </li>
        
      
      
      
      
      
      
      <li><a href="https://github.com/msgflo">GitHub</a></li>
      
    </ul>
  </ul>
</nav>

    
<main>
  <article>
    
    <h1>Component library</h1>
    
    <p>A component is a piece of code which can instantiate a MsgFlo participant.
By default such component code is placed in <code class="highlighter-rouge">./participants/</code> directory of a project.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp ./node_modules/msgflo-nodejs/examples/Repeat.coffee ./participants/
</code></pre></div></div>

<p>Declaring a command template in <code class="highlighter-rouge">package.json</code> tells MsgFlo how to instantiate them.
This can be done per component, or by specifying a handler for a given file extension,
which makes each matching file in the component directory (here: <code class="highlighter-rouge">Repeat</code>) automatically available as a component.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="s2">"msgflo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"handlers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">".coffee"</span><span class="p">:</span><span class="w"> </span><span class="s2">"msgflo-nodejs --name #ROLE #FILENAME"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"components"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"noflo-runtime-msgflo --name out --graph core/Output --broker amqp://localhost"</span><span class="w">
     </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>The component command template supports substituting several variables, including:</p>

<ul>
  <li><code class="highlighter-rouge">#FILENAME</code>: Full path to the file with the component code</li>
  <li><code class="highlighter-rouge">#ROLE</code>: Name of the role to instantiate as</li>
  <li><code class="highlighter-rouge">#COMPONENT</code>: Full name of component, as named in graph (project/Component).</li>
  <li><code class="highlighter-rouge">#COMPONENTNAME</code>: Name of component without project/ (Component)</li>
</ul>

<p>Now the example service above can be started with a single command:
By enabling <code class="highlighter-rouge">--participants</code> MsgFlo will start the individual participants.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msgflo-setup ./myservice.fbp --broker amqp://localhost --participants --forward=stdout
</code></pre></div></div>

<p>Using <code class="highlighter-rouge">--forward stdout</code> enables seeing the output from the <code class="highlighter-rouge">Output</code> participant, which is in a child process.</p>

<p>Send message again, and it should be repeated on stdout.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msgflo-send-message --queue repeater.IN --json '{ "foo": "bar-with-componentlib" }'
</code></pre></div></div>

<p>Having component handlers facilitates live-programming from Flowhub IDE:
Adding a new component with Python code will get a .py file extension,
and the handler for <code class="highlighter-rouge">py</code> will be used to instantiate a new process.</p>

<h3 id="defaults">Defaults</h3>

<p>By default MsgFlo reads its component library configuration from the <code class="highlighter-rouge">package.json</code> (used by NPM).
You can specify an alternative JSON file using <code class="highlighter-rouge">--library msgflo.json</code>.
The configuration object can either exist at the top-level, or under a <code class="highlighter-rouge">msgflo</code> key.</p>

<p>There are <a href="https://github.com/msgflo/msgflo/blob/master/src/library.coffee#L9">default handlers</a> specified
for common supported environments. These do not need to be specified manually.</p>

<ul>
  <li><code class="highlighter-rouge">.py</code> (msgflo-python)</li>
  <li><code class="highlighter-rouge">.coffee</code>, <code class="highlighter-rouge">.js</code> (msgflo-nodejs)</li>
  <li><code class="highlighter-rouge">.json</code> and <code class="highlighter-rouge">.fbp</code> (noflo-runtime-msgflo)</li>
</ul>


  </article>
  <nav class="docs">
  
  
  <ul>
  
  
    <li>
      <a href="/docs/usage/index.html">
        Usage
      </a>
    </li>
  
    <li>
      <a href="/docs/communications/index.html">
        Discovery protocol
      </a>
    </li>
  
    <li>
      <a href="/docs/library/index.html" class="current">
        Component library
      </a>
    </li>
  
    <li>
      <a href="/docs/architecture/index.html">
        Architecture
      </a>
    </li>
  
    <li>
      <a href="/docs/heroku/index.html">
        Heroku deployment
      </a>
    </li>
  
    <li>
      <a href="/docs/foreign/index.html">
        Non-MsgFlo-aware participants
      </a>
    </li>
  
    <li>
      <a href="/docs/best-practices/index.html">
        Best practices
      </a>
    </li>
  
  </ul>
  

  

  

  

</nav>

</main>

  </body>
</html>
